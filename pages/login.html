<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Login - MAINTAIN HEALTH</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 16px;
        }

        /* LOGIN SCREEN */
        #login-screen {
            background: white;
            border-radius: 24px;
            padding: 24px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .login-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .login-header h2 {
            color: #333;
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .login-header p {
            color: #666;
            font-size: 0.95rem;
        }

        .login-header .back-icon {
            font-size: 2rem;
            margin-bottom: 16px;
            display: block;
        }

        /* LOGIN METHODS */
        .login-methods {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 24px;
        }

        .login-method-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            padding: 16px;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 16px;
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            transition: all 0.3s;
        }

        .login-method-btn:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateY(-2px);
        }

        .login-method-btn i {
            font-size: 1.4rem;
        }

        /* LOGIN FORM */
        .login-form {
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .form-group input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-group input:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .password-input {
            position: relative;
        }

        .toggle-password {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #666;
        }

        /* BUTTONS */
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 16px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 12px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
            border: 2px solid #e0e0e0;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        /* LINKS */
        .forgot-password {
            text-align: center;
            margin: 20px 0;
        }

        .forgot-password a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .forgot-password a:hover {
            text-decoration: underline;
        }

        .register-link {
            text-align: center;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 2px solid #f0f0f0;
            color: #666;
        }

        .register-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        /* RESET BUTTON */
        .reset-data-btn {
            text-align: center;
            margin-top: 16px;
        }

        .reset-data-btn button {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 0.85rem;
            text-decoration: underline;
            padding: 0;
        }

        .reset-data-btn button:hover {
            color: #f56565;
        }

        /* OTP SCREEN */
        .otp-screen {
            text-align: center;
        }

        .otp-header {
            margin-bottom: 32px;
        }

        .otp-header h3 {
            color: #333;
            font-size: 1.5rem;
            margin-bottom: 8px;
        }

        .otp-header p {
            color: #666;
        }

        .otp-inputs {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 32px 0;
        }

        .otp-input {
            width: 50px;
            height: 60px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            transition: all 0.3s;
        }

        .otp-input:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .resend-link {
            color: #667eea;
            cursor: pointer;
            font-weight: 600;
            margin: 16px 0;
            display: inline-block;
        }

        .resend-link:hover {
            text-decoration: underline;
        }

        .timer {
            color: #666;
            font-size: 0.9rem;
            margin: 8px 0;
        }

        /* NOTIFICATION */
        .custom-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 10000;
            animation: slideIn 0.3s;
            max-width: 350px;
        }

        .notification-success {
            border-left: 4px solid #48bb78;
        }

        .notification-error {
            border-left: 4px solid #f56565;
        }

        .notification-info {
            border-left: 4px solid #4299e1;
        }

        .notification-icon {
            font-size: 24px;
        }

        .notification-message {
            color: #333;
            font-size: 0.95rem;
            flex: 1;
        }

        .notification-close {
            color: #999;
            cursor: pointer;
            font-size: 18px;
            padding: 0 4px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div id="login-screen">
        <div class="login-header">
            <span class="back-icon">üîê</span>
            <h2>MAINTAIN HEALTH</h2>
            <p>Silakan masuk ke akun Anda</p>
        </div>

        <!-- LOGIN METHODS -->
        <div id="login-methods" class="login-methods">
            <button class="login-method-btn" onclick="showEmailLogin()">
                <span>üìß</span> Masuk dengan Email
            </button>
            <button class="login-method-btn" onclick="showPhoneLogin()">
                <span>üì±</span> Masuk dengan Nomor Telepon
            </button>
        </div>

        <!-- LOGIN FORM (EMAIL) - HIDDEN AWAL -->
        <div id="email-login" class="login-form hidden">
            <div class="form-group">
                <label>üìß Email</label>
                <input type="email" id="email" placeholder="contoh@email.com">
            </div>
            <div class="form-group">
                <label>üîí Password</label>
                <div class="password-input">
                    <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    <span class="toggle-password" onclick="togglePassword('password')">üëÅÔ∏è</span>
                </div>
            </div>
            <button class="btn btn-primary" onclick="processLogin()">Masuk</button>
            <button class="btn btn-secondary" onclick="showLoginMethods()">Kembali</button>
        </div>

        <!-- LOGIN FORM (PHONE) - HIDDEN AWAL -->
        <div id="phone-login" class="login-form hidden">
            <div class="form-group">
                <label>üì± Nomor Telepon</label>
                <input type="tel" id="phone" placeholder="081234567890">
            </div>
            <div class="form-group">
                <label>üîí Password</label>
                <div class="password-input">
                    <input type="password" id="phone-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    <span class="toggle-password" onclick="togglePassword('phone-password')">üëÅÔ∏è</span>
                </div>
            </div>
            <button class="btn btn-primary" onclick="processLogin()">Masuk</button>
            <button class="btn btn-secondary" onclick="showLoginMethods()">Kembali</button>
        </div>

        <!-- FORGOT PASSWORD - HIDDEN AWAL -->
        <div id="forgot-password" class="login-form hidden">
            <div class="form-group">
                <label>üìß Email / üì± Nomor Telepon</label>
                <input type="text" id="forgot-input" placeholder="Masukkan email atau nomor telepon">
            </div>
            <button class="btn btn-primary" onclick="sendOTP()">Kirim Kode OTP</button>
            <button class="btn btn-secondary" onclick="showLoginMethods()">Kembali</button>
        </div>

        <!-- REGISTER FORM - HIDDEN AWAL -->
        <div id="register-form" class="login-form hidden">
            <div class="form-group">
                <label>üë§ Nama Lengkap</label>
                <input type="text" id="reg-name" placeholder="Masukkan nama lengkap">
            </div>
            <div class="form-group">
                <label>üìß Email</label>
                <input type="email" id="reg-email" placeholder="contoh@email.com">
            </div>
            <div class="form-group">
                <label>üì± Nomor Telepon</label>
                <input type="tel" id="reg-phone" placeholder="081234567890">
            </div>
            <div class="form-group">
                <label>üîí Password</label>
                <div class="password-input">
                    <input type="password" id="reg-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    <span class="toggle-password" onclick="togglePassword('reg-password')">üëÅÔ∏è</span>
                </div>
            </div>
            <div class="form-group">
                <label>üîí Konfirmasi Password</label>
                <div class="password-input">
                    <input type="password" id="reg-confirm-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    <span class="toggle-password" onclick="togglePassword('reg-confirm-password')">üëÅÔ∏è</span>
                </div>
            </div>
            <button class="btn btn-primary" onclick="processRegister()">Daftar</button>
            <button class="btn btn-secondary" onclick="showLoginMethods()">Kembali</button>
        </div>

        <!-- OTP SCREEN - HIDDEN AWAL -->
        <div id="otp-screen" class="otp-screen hidden">
            <div class="otp-header">
                <h3>üîë Masukkan Kode OTP</h3>
                <p>Kode 6 digit telah dikirim ke email/telepon Anda</p>
            </div>
            
            <div class="otp-inputs">
                <input type="text" class="otp-input" maxlength="1" onkeyup="moveToNext(this, 0)" onkeypress="return onlyNumber(event)">
                <input type="text" class="otp-input" maxlength="1" onkeyup="moveToNext(this, 1)" onkeypress="return onlyNumber(event)">
                <input type="text" class="otp-input" maxlength="1" onkeyup="moveToNext(this, 2)" onkeypress="return onlyNumber(event)">
                <input type="text" class="otp-input" maxlength="1" onkeyup="moveToNext(this, 3)" onkeypress="return onlyNumber(event)">
                <input type="text" class="otp-input" maxlength="1" onkeyup="moveToNext(this, 4)" onkeypress="return onlyNumber(event)">
                <input type="text" class="otp-input" maxlength="1" onkeyup="moveToNext(this, 5)" onkeypress="return onlyNumber(event)">
            </div>

            <div class="timer" id="timer">00:60</div>
            
            <button class="btn btn-primary" onclick="verifyOTP()">Verifikasi</button>
            
            <div>
                <span class="resend-link" onclick="resendOTP()">Kirim ulang kode</span>
            </div>
            
            <button class="btn btn-secondary" onclick="backToForgot()">Kembali</button>
        </div>

        <!-- FORGOT PASSWORD LINK -->
        <div class="forgot-password">
            <a href="#" onclick="showForgotPassword()">Lupa password?</a>
        </div>

        <!-- REGISTER LINK -->
        <div class="register-link">
            Belum punya akun? <a href="#" onclick="showRegister()">Daftar</a>
        </div>

        <!-- RESET DATA -->
        <div class="reset-data-btn">
            <button onclick="resetAllData()">üîÑ Reset Data</button>
        </div>
    </div>

   <script>
    // ========== NOTIFICATION SYSTEM ==========
    function showNotification(message, type = 'success') {
        const notif = document.createElement('div');
        notif.className = `custom-notification notification-${type}`;
        notif.innerHTML = `
            <span class="notification-icon">${getIcon(type)}</span>
            <span class="notification-message">${message}</span>
            <span class="notification-close" onclick="this.parentElement.remove()">‚úï</span>
        `;
        document.body.appendChild(notif);

        setTimeout(() => {
            if (notif.parentElement) notif.remove();
        }, 3000);
    }

    function getIcon(type) {
        switch(type) {
            case 'success': return '‚úÖ';
            case 'error': return '‚ùå';
            case 'info': return '‚ÑπÔ∏è';
            default: return '‚úÖ';
        }
    }

    // ========== NAVIGATION ==========
    function showLoginMethods() {
        hideAll();
        document.getElementById('login-methods').classList.remove('hidden');
    }

    function showEmailLogin() {
        hideAll();
        document.getElementById('email-login').classList.remove('hidden');
    }

    function showPhoneLogin() {
        hideAll();
        document.getElementById('phone-login').classList.remove('hidden');
    }

    function showForgotPassword() {
        hideAll();
        document.getElementById('forgot-password').classList.remove('hidden');
    }

    function backToForgot() {
        hideAll();
        document.getElementById('forgot-password').classList.remove('hidden');
    }

    function showRegister() {
        hideAll();
        document.getElementById('register-form').classList.remove('hidden');
    }

    function hideAll() {
        document.getElementById('login-methods').classList.add('hidden');
        document.getElementById('email-login').classList.add('hidden');
        document.getElementById('phone-login').classList.add('hidden');
        document.getElementById('forgot-password').classList.add('hidden');
        document.getElementById('otp-screen').classList.add('hidden');
        document.getElementById('register-form').classList.add('hidden');
    }

    // ========== PASSWORD ==========
    function togglePassword(id) {
        const input = document.getElementById(id);
        input.type = input.type === 'password' ? 'text' : 'password';
    }

    // ========== LOGIN PROCESS ==========
    function processLogin() {
        let email = (document.getElementById('email')?.value || '').trim();
        let phone = (document.getElementById('phone')?.value || '').replace(/[^0-9]/g, '').trim();
        const password = (document.getElementById('password')?.value || document.getElementById('phone-password')?.value || '').trim();

        if (!email && !phone) {
            showNotification('Masukkan email atau nomor telepon', 'error');
            return;
        }

        if (!password) {
            showNotification('Masukkan password', 'error');
            return;
        }

        // Ambil semua user dari localStorage
        const users = JSON.parse(localStorage.getItem('users') || '[]');

        // Cari user berdasarkan email atau nomor telepon (normalisasi untuk perbandingan)
        const foundUser = users.find(user => {
            const uEmail = user.email ? user.email.toLowerCase().trim() : '';
            const uPhone = user.phone ? user.phone.replace(/[^0-9]/g, '').trim() : '';

            if (email && uEmail && uEmail === email.toLowerCase()) return true;
            if (phone && uPhone && uPhone === phone) return true;
            return false;
        });

        if (!foundUser) {
            showNotification('Email atau nomor telepon tidak terdaftar. Silakan daftar terlebih dahulu', 'error');
            return;
        }

        // Validasi password
        if ((foundUser.password || '').trim() !== password) {
            showNotification('Password tidak sesuai', 'error');
            return;
        }

        // Simpan user yang login
        localStorage.setItem('currentUser', JSON.stringify(foundUser));

        showNotification('Login berhasil!', 'success');

        setTimeout(() => {
            window.location.href = 'dashboard.html';
        }, 1200);
    }

    // ========== OTP ==========
    function sendOTP() {
        let input = (document.getElementById('forgot-input').value || '').trim();
        if (!input) {
            showNotification('Masukkan email atau nomor telepon', 'error');
            return;
        }

        // normalisasi input
        const inputIsEmail = /@/.test(input);
        const normalizedInputEmail = inputIsEmail ? input.toLowerCase() : '';
        const normalizedInputPhone = inputIsEmail ? '' : input.replace(/[^0-9]/g, '');

        // Ambil semua user dari localStorage
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        
        // Cari user berdasarkan email atau nomor telepon (normalisasi)
        const foundUser = users.find(user => {
            const uEmail = user.email ? user.email.toLowerCase().trim() : '';
            const uPhone = user.phone ? user.phone.replace(/[^0-9]/g, '').trim() : '';

            if (normalizedInputEmail && uEmail === normalizedInputEmail) return true;
            if (normalizedInputPhone && uPhone === normalizedInputPhone) return true;
            return false;
        });
        
        if (!foundUser) {
            showNotification('Email atau nomor telepon tidak terdaftar', 'error');
            return;
        }

        // Generate OTP random 6 digit
        const otp = Math.floor(100000 + Math.random() * 900000).toString();
        
        // Simpan OTP dan contact ke localStorage
        localStorage.setItem('tempOTP', otp);
        localStorage.setItem('forgotContact', input);
        
        hideAll();
        document.getElementById('otp-screen').classList.remove('hidden');
        
        // Tampilkan OTP di alert
        alert(`üìå Kode OTP Anda:\n\n${otp}\n\nKode berlaku 60 detik`);
        showNotification(`‚úÖ Kode OTP telah dikirim ke ${input}`, 'success');
        
        startOTPTimer();
    }

    function startOTPTimer() {
        let timeLeft = 60;
        const timerElement = document.getElementById('timer');
        
        const interval = setInterval(() => {
            timeLeft--;
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerElement.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            
            if (timeLeft <= 0) {
                clearInterval(interval);
                timerElement.textContent = 'Kode kadaluarsa';
            }
        }, 1000);
    }

    function verifyOTP() {
        // Ambil OTP dari input fields
        const otpInputs = document.querySelectorAll('.otp-input');
        const enteredOTP = Array.from(otpInputs).map(input => input.value).join('');
        
        // Ambil OTP yang benar dari localStorage
        const correctOTP = localStorage.getItem('tempOTP');
        
        if (enteredOTP.length !== 6) {
            showNotification('Masukkan kode OTP 6 digit', 'error');
            return;
        }
        
        if (enteredOTP !== correctOTP) {
            showNotification('Kode OTP tidak sesuai', 'error');
            return;
        }
        
        showNotification('‚úÖ OTP berhasil diverifikasi', 'success');
        
        // Clear OTP inputs
        otpInputs.forEach(input => input.value = '');
        
        setTimeout(() => {
            window.location.href = 'dashboard.html';
        }, 1200);
    }

    function resendOTP() {
        showNotification('Kode OTP telah dikirim ulang');
        startOTPTimer();
    }

    function moveToNext(input, index) {
        if (input.value.length === 1) {
            const inputs = document.querySelectorAll('.otp-input');
            if (index < inputs.length - 1) {
                inputs[index + 1].focus();
            }
        }
    }

    function onlyNumber(event) {
        const charCode = event.which ? event.which : event.keyCode;
        if (charCode < 48 || charCode > 57) {
            return false;
        }
        return true;
    }

    // ========== REGISTER PROCESS ==========
    function processRegister() {
        const name = document.getElementById('reg-name').value;
        const email = document.getElementById('reg-email').value;
        const phone = document.getElementById('reg-phone').value;
        const password = document.getElementById('reg-password').value;
        const confirmPassword = document.getElementById('reg-confirm-password').value;

        // Validasi
        if (!name) {
            showNotification('Masukkan nama lengkap', 'error');
            return;
        }

        if (!email) {
            showNotification('Masukkan email', 'error');
            return;
        }

        if (!phone) {
            showNotification('Masukkan nomor telepon', 'error');
            return;
        }

        if (!password || password.length < 6) {
            showNotification('Password minimal 6 karakter', 'error');
            return;
        }

        if (password !== confirmPassword) {
            showNotification('Password tidak cocok', 'error');
            return;
        }

        // Validasi email format
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            showNotification('Format email tidak valid', 'error');
            return;
        }

        // Validasi nomor telepon
        if (!/^\d{10,}$/.test(phone.replace(/[\s\-()]/g, ''))) {
            showNotification('Nomor telepon tidak valid', 'error');
            return;
        }

        // Ambil semua user dari localStorage
        const users = JSON.parse(localStorage.getItem('users') || '[]');

        // normalisasi input untuk perbandingan dan penyimpanan
        const normalizedEmail = email.toLowerCase();
        const normalizedPhone = phone.replace(/[^0-9]/g, '');

        // Cek apakah email sudah terdaftar
        const emailExists = users.some(user => 
            user.email && user.email.toLowerCase().trim() === normalizedEmail.trim()
        );
        
        if (emailExists) {
            showNotification('Email sudah terdaftar', 'error');
            return;
        }

        // Cek apakah nomor telepon sudah terdaftar
        const phoneExists = users.some(user => 
            user.phone && user.phone.replace(/[^0-9]/g, '').trim() === normalizedPhone.trim()
        );
        
        if (phoneExists) {
            showNotification('Nomor telepon sudah terdaftar', 'error');
            return;
        }

        // Buat object user baru (simpan email lowercase dan phone hanya digit)
        const newUser = {
            name: name,
            email: normalizedEmail,
            phone: normalizedPhone,
            password: password.trim(),
            registerTime: new Date().toISOString()
        };

        // Tambahkan user baru ke array
        users.push(newUser);

        // Simpan array users ke localStorage
        localStorage.setItem('users', JSON.stringify(users));

        showNotification('‚úÖ Akun berhasil dibuat! Silakan login...', 'success');

        setTimeout(() => {
            showLoginMethods();
            // Reset form
            document.getElementById('reg-name').value = '';
            document.getElementById('reg-email').value = '';
            document.getElementById('reg-phone').value = '';
            document.getElementById('reg-password').value = '';
            document.getElementById('reg-confirm-password').value = '';
        }, 1500);
    }

    // ========== INIT ==========
    function resetAllData() {
        if (confirm('‚ö†Ô∏è Yakin ingin menghapus SEMUA data? Tindakan ini tidak bisa dibatalkan!')) {
            localStorage.clear();
            showNotification('‚úÖ Semua data berhasil dihapus!', 'success');
            setTimeout(() => {
                location.reload();
            }, 1500);
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        const currentUser = localStorage.getItem('currentUser');
        if (currentUser) {
            document.querySelector('.login-header p').textContent =
                'Selamat datang kembali!';
        }
    });
</script>