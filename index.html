<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>MAINTAIN HEALTH</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#667eea">

<style>
*{
margin:0;
padding:0;
box-sizing:border-box;
font-family:system-ui,-apple-system,'Segoe UI',Roboto,sans-serif;
}

body{
background:linear-gradient(135deg,#667eea,#764ba2);
min-height:100vh;
display:flex;
justify-content:center;
align-items:center;
padding:16px;
}

/* SPLASH */
#splash-screen{
position:fixed;
inset:0;
background:linear-gradient(135deg,#667eea,#764ba2);
display:flex;
justify-content:center;
align-items:center;
z-index:9999;
transition:0.4s;
}

.splash-content{
text-align:center;
color:white;
}

.loader{
width:45px;
height:45px;
border:4px solid #fff;
border-top:4px solid #00000030;
border-radius:50%;
animation:spin 1s linear infinite;
margin:auto;
margin-top:20px;
}

@keyframes spin{
to{transform:rotate(360deg)}
}

/* PERMISSION */
#permission-screen{
background:white;
border-radius:20px;
padding:22px;
width:100%;
max-width:480px;
box-shadow:0 20px 40px rgba(0,0,0,0.2);
display:none;
}

.permission-item{
display:flex;
justify-content:space-between;
align-items:center;
padding:14px;
background:#f5f5f5;
border-radius:14px;
margin-bottom:10px;
}

.permission-btn{
border:none;
padding:7px 16px;
border-radius:20px;
cursor:pointer;
background:#667eea;
color:white;
}

.permission-btn.granted{
background:#48bb78;
}

/* BUTTON */
#continue-btn{
width:100%;
padding:14px;
margin-top:20px;
border:none;
border-radius:12px;
background:#667eea;
color:white;
opacity:0.5;
pointer-events:none;
}

#continue-btn.active{
opacity:1;
pointer-events:auto;
}

/* NOTIFICATION */
.custom-notification{
position:fixed;
top:20px;
right:20px;
background:white;
padding:12px 18px;
border-radius:10px;
box-shadow:0 10px 30px rgba(0,0,0,0.2);
animation:slide 0.3s;
}

@keyframes slide{
from{transform:translateX(100%)}
to{transform:translateX(0)}
}
</style>
</head>

<body>

<!-- SPLASH -->
<div id="splash-screen">
<div class="splash-content">
<h1>MAINTAIN HEALTH</h1>
<p>by Salsabillah Kirana Rahmadhani</p>
<div class="loader"></div>
</div>
</div>

<!-- PERMISSION -->
<div id="permission-screen">

<h2>üîê Izin Aplikasi</h2>
<p>Izinkan akses berikut</p>

<div class="permission-item">
<span>üîî Notifikasi</span>
<button id="btn-notification" class="permission-btn"
onclick="requestPermission('notification')">
Izinkan
</button>
</div>

<div class="permission-item">
<span>üìç Lokasi</span>
<button id="btn-location" class="permission-btn"
onclick="requestPermission('location')">
Izinkan
</button>
</div>

<div class="permission-item">
<span>üì∑ Kamera</span>
<button id="btn-camera" class="permission-btn"
onclick="requestPermission('camera')">
Izinkan
</button>
</div>

<div class="permission-item">
<span>üé§ Mikrofon</span>
<button id="btn-mic" class="permission-btn"
onclick="requestPermission('mic')">
Izinkan
</button>
</div>

<button id="continue-btn"
onclick="continueToLogin()">
Lanjutkan ke Login
</button>

</div>

<script>
/* ======================
REGISTER SERVICE WORKER
====================== */
if ('serviceWorker' in navigator) {
navigator.serviceWorker.register('service-worker.js');
}

/* ======================
SPLASH SCREEN
====================== */
setTimeout(()=>{
document.getElementById("splash-screen").style.display="none";
document.getElementById("permission-screen").style.display="block";
},2500);

/* ======================
PERMISSION STATE
====================== */
let permissions={
notification:false,
location:false,
camera:false,
mic:false
};

/* ======================
REQUEST PERMISSION
====================== */
async function requestPermission(type){

if(type==="notification"){
const result=await Notification.requestPermission();
if(result==="granted"){
updatePermission(type);
}
}

if(type==="location"){
navigator.geolocation.getCurrentPosition(()=>{
updatePermission(type);
});
}

if(type==="camera"){
try{
let stream=await navigator.mediaDevices.getUserMedia({video:true});
stream.getTracks().forEach(t=>t.stop());
updatePermission(type);
}catch{}
}

if(type==="mic"){
try{
let stream=await navigator.mediaDevices.getUserMedia({audio:true});
stream.getTracks().forEach(t=>t.stop());
updatePermission(type);
}catch{}
}

}

/* ======================
UPDATE UI
====================== */
function updatePermission(type){
permissions[type]=true;

let btn=document.getElementById("btn-"+type);
btn.innerText="Diizinkan";
btn.classList.add("granted");

checkPermissions();
}

/* ======================
CHECK ALL
====================== */
function checkPermissions(){
let total=Object.values(permissions).filter(v=>v).length;

if(total>=2){
document.getElementById("continue-btn")
.classList.add("active");
}
}

/* ======================
CONTINUE
====================== */
function continueToLogin(){
window.location.href="pages/login.html";
}
</script>

</body>
</html>